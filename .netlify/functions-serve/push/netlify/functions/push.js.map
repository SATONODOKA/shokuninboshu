{
  "version": 3,
  "sources": ["../../../../../../Users/satonodoka/Desktop/shokuninboshu/shokuninboshu-app/netlify/functions/push.ts"],
  "sourceRoot": "/var/folders/hc/8f_g4lqn545fsghk0gdpyx_00000gn/T/tmp-58431-DSpDN6EPxXXZ",
  "sourcesContent": ["import type { Handler } from '@netlify/functions';\n\nexport const handler: Handler = async (event) => {\n  const headers = {\n    'Content-Type': 'application/json',\n    'Access-Control-Allow-Origin': '*',\n    'Access-Control-Allow-Headers': 'Content-Type',\n    'Access-Control-Allow-Methods': 'POST, OPTIONS'\n  };\n\n  if (event.httpMethod === 'OPTIONS') {\n    return { statusCode: 200, headers, body: '' };\n  }\n\n  try {\n    console.log('Push function called');\n    console.log('Environment check:', {\n      hasToken: !!process.env.LINE_CHANNEL_ACCESS_TOKEN,\n      tokenLength: process.env.LINE_CHANNEL_ACCESS_TOKEN?.length || 0,\n      hasSecret: !!process.env.LINE_CHANNEL_SECRET,\n      nodeEnv: process.env.NODE_ENV\n    });\n    \n    if (!process.env.LINE_CHANNEL_ACCESS_TOKEN) {\n      console.error('LINE_CHANNEL_ACCESS_TOKEN not configured');\n      return {\n        statusCode: 500,\n        headers,\n        body: JSON.stringify({ error: 'LINE_CHANNEL_ACCESS_TOKEN not configured' })\n      };\n    }\n\n    const { to, messages } = JSON.parse(event.body || '{}');\n    console.log('Request payload:', { to, messagesCount: messages?.length });\n    \n    if (!to || !Array.isArray(messages)) {\n      console.error('Invalid payload:', { to, messages: Array.isArray(messages) });\n      return {\n        statusCode: 400,\n        headers,\n        body: JSON.stringify({ error: 'Invalid payload: to and messages required' })\n      };\n    }\n\n    console.log(`Sending LINE message to: ${to}`);\n    console.log(`Messages: ${JSON.stringify(messages, null, 2)}`);\n\n    const res = await fetch('https://api.line.me/v2/bot/message/push', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${process.env.LINE_CHANNEL_ACCESS_TOKEN}`\n      },\n      body: JSON.stringify({ to, messages })\n    });\n\n    const text = await res.text();\n    console.log(`LINE API Response: ${res.status} - ${text}`);\n    \n    return {\n      statusCode: res.status,\n      headers,\n      body: res.ok ? text : JSON.stringify({ error: text })\n    };\n  } catch (e: any) {\n    return {\n      statusCode: 500,\n      headers,\n      body: JSON.stringify({ error: e?.message || 'Internal server error' })\n    };\n  }\n};"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAEO,IAAM,UAAmB,OAAO,UAAU;AAC/C,QAAM,UAAU;AAAA,IACd,gBAAgB;AAAA,IAChB,+BAA+B;AAAA,IAC/B,gCAAgC;AAAA,IAChC,gCAAgC;AAAA,EAClC;AAEA,MAAI,MAAM,eAAe,WAAW;AAClC,WAAO,EAAE,YAAY,KAAK,SAAS,MAAM,GAAG;AAAA,EAC9C;AAEA,MAAI;AACF,YAAQ,IAAI,sBAAsB;AAClC,YAAQ,IAAI,sBAAsB;AAAA,MAChC,UAAU,CAAC,CAAC,QAAQ,IAAI;AAAA,MACxB,aAAa,QAAQ,IAAI,2BAA2B,UAAU;AAAA,MAC9D,WAAW,CAAC,CAAC,QAAQ,IAAI;AAAA,MACzB,SAAS,QAAQ,IAAI;AAAA,IACvB,CAAC;AAED,QAAI,CAAC,QAAQ,IAAI,2BAA2B;AAC1C,cAAQ,MAAM,0CAA0C;AACxD,aAAO;AAAA,QACL,YAAY;AAAA,QACZ;AAAA,QACA,MAAM,KAAK,UAAU,EAAE,OAAO,2CAA2C,CAAC;AAAA,MAC5E;AAAA,IACF;AAEA,UAAM,EAAE,IAAI,SAAS,IAAI,KAAK,MAAM,MAAM,QAAQ,IAAI;AACtD,YAAQ,IAAI,oBAAoB,EAAE,IAAI,eAAe,UAAU,OAAO,CAAC;AAEvE,QAAI,CAAC,MAAM,CAAC,MAAM,QAAQ,QAAQ,GAAG;AACnC,cAAQ,MAAM,oBAAoB,EAAE,IAAI,UAAU,MAAM,QAAQ,QAAQ,EAAE,CAAC;AAC3E,aAAO;AAAA,QACL,YAAY;AAAA,QACZ;AAAA,QACA,MAAM,KAAK,UAAU,EAAE,OAAO,4CAA4C,CAAC;AAAA,MAC7E;AAAA,IACF;AAEA,YAAQ,IAAI,4BAA4B,EAAE,EAAE;AAC5C,YAAQ,IAAI,aAAa,KAAK,UAAU,UAAU,MAAM,CAAC,CAAC,EAAE;AAE5D,UAAM,MAAM,MAAM,MAAM,2CAA2C;AAAA,MACjE,QAAQ;AAAA,MACR,SAAS;AAAA,QACP,gBAAgB;AAAA,QAChB,iBAAiB,UAAU,QAAQ,IAAI,yBAAyB;AAAA,MAClE;AAAA,MACA,MAAM,KAAK,UAAU,EAAE,IAAI,SAAS,CAAC;AAAA,IACvC,CAAC;AAED,UAAM,OAAO,MAAM,IAAI,KAAK;AAC5B,YAAQ,IAAI,sBAAsB,IAAI,MAAM,MAAM,IAAI,EAAE;AAExD,WAAO;AAAA,MACL,YAAY,IAAI;AAAA,MAChB;AAAA,MACA,MAAM,IAAI,KAAK,OAAO,KAAK,UAAU,EAAE,OAAO,KAAK,CAAC;AAAA,IACtD;AAAA,EACF,SAAS,GAAQ;AACf,WAAO;AAAA,MACL,YAAY;AAAA,MACZ;AAAA,MACA,MAAM,KAAK,UAAU,EAAE,OAAO,GAAG,WAAW,wBAAwB,CAAC;AAAA,IACvE;AAAA,EACF;AACF;",
  "names": []
}
